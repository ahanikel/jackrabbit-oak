#!/usr/bin/env bash
cd $(dirname $0)

export KAFKA_TOPIC=nodestates
export KAFKA_SERVERS=localhost:9092
export clusterInstances=1
export writeBackJournal=true
export customBlobStore=false
export backendPrefix=localhost
export blobendPrefix=localhost
export journalPrefix=localhost
export initJournal=undefined
export logNodeStates=false

debug="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=6006"
logging="-Dorg.slf4j.simpleLogger.showDateTime=true -Dorg.slf4j.simpleLogger.dateTimeFormat=yyyy-MM-dd'T'HH:mm:ss.SSSZ"
jar=~/Documents/git/jackrabbit-oak/oak-store-zeromq-service-store/target/oak-store-zeromq-service-store-1.38.0-zeromq-jar-with-dependencies.jar
jarOpts="log test-diff-1.38.0.log"
#jarOpts="server httpbackend.yaml"
native="-Djava.library.path=/usr/local/lib" # for libjzmq

ps auxww | grep java | grep oak-store-zeromq-service-store | awk '{print $2}' | xargs kill -9
sleep 1
touch test-diff-1.38.0.log
java -Xmx16g $debug $logging $native -jar $jar $jarOpts
